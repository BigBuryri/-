<% const title = "–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Äî –ö–æ—Ä–æ—á–∫–∏.–µ—Å—Ç—å"; %>
<%- include("partials/top", { title }) %>

<div class="row row--space row--wrap">
  <div>
    <h1 class="h1">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
    <p class="muted">–í—Å–µ –∑–∞—è–≤–∫–∏. –§–∏–ª—å—Ç—Ä—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞.</p>
  </div>
  <a class="btn btn--ghost" href="/admin/logout">–í—ã–π—Ç–∏</a>
</div>

<section class="card card--glass mb">
  <form class="form form--filters" method="get" action="/admin">
    <div class="field">
      <label>–ü–æ–∏—Å–∫ (–ª–æ–≥–∏–Ω/–§–ò–û)</label>
      <input name="q" value="<%= filters.q %>" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ivan –∏–ª–∏ –ò–≤–∞–Ω–æ–≤" />
    </div>

    <div class="field">
      <label>–°—Ç–∞—Ç—É—Å</label>
      <select name="status">
        <option value="">–í—Å–µ</option>
        <% statuses.forEach(s => { %>
          <option value="<%= s %>" <%= (filters.status===s) ? "selected" : "" %>><%= s %></option>
        <% }) %>
      </select>
    </div>

    <div class="field">
      <label>–ö—É—Ä—Å</label>
      <select name="course">
        <option value="">–í—Å–µ</option>
        <% courses.forEach(c => { %>
          <option value="<%= c %>" <%= (filters.course===c) ? "selected" : "" %>><%= c %></option>
        <% }) %>
      </select>
    </div>

    <div class="field">
      <label>&nbsp;</label>
      <button class="btn btn--primary btn--block">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </div>
  </form>
</section>

<section class="card card--glass">
  <div class="table">
    <div class="table__head">
      <div>#</div>
      <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
      <div>–ö—É—Ä—Å</div>
      <div>–°—Ç–∞—Ä—Ç</div>
      <div>–û–ø–ª–∞—Ç–∞</div>
      <div>–°—Ç–∞—Ç—É—Å</div>
      <div class="right">–î–µ–π—Å—Ç–≤–∏—è</div>
    </div>

    <% if (items.length) { %>
      <% items.forEach(a => { %>
        <div class="table__row">
          <div>#<%= a.id %></div>
          <div>
            <div class="strong"><%= a.full_name %></div>
            <div class="muted small">@<%= a.login %> ‚Ä¢ <%= a.phone %></div>
          </div>
          <div><%= a.course_name %></div>
          <div><%= new Date(a.desired_start_date).toLocaleDateString("ru-RU") %></div>
          <div><%= a.payment_method === "cash" ? "–ù–∞–ª–∏—á–Ω—ã–º–∏" : "–ü–µ—Ä–µ–≤–æ–¥" %></div>
          <div>
            <span class="pill <%= a.status === "–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ" ? "pill--success" : (a.status === "–ò–¥–µ—Ç –æ–±—É—á–µ–Ω–∏–µ" ? "pill--warn" : "pill--info") %>"><%= a.status %></span>
          </div>
          <div class="right">
            <form class="row row--gap" method="post" action="/admin/applications/<%= a.id %>/status">
              <select name="status">
                <% statuses.forEach(s => { %>
                  <option value="<%= s %>" <%= (a.status===s) ? "selected" : "" %>><%= s %></option>
                <% }) %>
              </select>
              <button class="btn btn--success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="pad muted">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ü§∑</div>
    <% } %>
  </div>
</section>

<% if (pages > 1) { %>
  <nav class="pager">
    <% function qs(p) { 
      const params = new URLSearchParams({ ...filters, page: String(p) });
      return "/admin?" + params.toString();
    } %>

    <a class="btn btn--ghost <%= page<=1 ? "is-disabled" : "" %>" href="<%= qs(Math.max(1, page-1)) %>">¬´</a>

    <% for (let p=1; p<=pages; p++) { %>
      <a class="btn <%= p===page ? "btn--primary" : "btn--ghost" %>" href="<%= qs(p) %>"><%= p %></a>
    <% } %>

    <a class="btn btn--ghost <%= page>=pages ? "is-disabled" : "" %>" href="<%= qs(Math.min(pages, page+1)) %>">¬ª</a>
  </nav>
<% } %>

<%- include("partials/bottom") %>
